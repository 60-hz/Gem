Coding Guidelines for Gem
=========================
2011-2014, IOhannes m zmÃ¶lnig

Questions
=========
read the entire CodingStyle guide.
if you still have questions, please ask them on the gem-dev mailinglist:
   http://lists.puredata.info/listinfo/gem-dev

Version Control System
======================
Gem uses `git` for source code management.
the official public repository is on github:
   https://github.com/umlaeute/Gem
a secondary repository is on sourceforge:
   git://git.code.sf.net/p/pd-gem/gem

contributing
------------
if you want to contribute, please make sure that your changes can be
applied to the latest HEAD (which might be slightly different from the one
when you started working on your contribution).

the preferred way for contributing is by forking the github repository
and creating a pull request once your code is ready.

if you do not want to create an account on github, this is fine as well.
Just clone the repository, and send me the patch-set.
e.g.

    $ git clone https://github.com/umlaeute/Gem.git
    $ cd Gem
    $ git checkout -b nifty_feature
    // now fix a bug
    $ git commit -m "fixed crasher bug"
    // now add a feature
    $ git commit -m "made zgonc work"

    $ git format-path master/origin
    // this will create a number of .patch files
    // zip them, and send them to me
    $ tar cvzf /tmp/nifty_feature.tgz *.patch


git commits
-----------
commit often!

We want to be able to track down a bug to the very commit it was introduced (e.g. using `git bisect`).
If this commit does numerous unrelated things, it makes finding the bug unnecessary complicated.

Here are a few rules that should help to make good commits:

Each commit should be a *small* and *incremental* change to the codebase.

please break your commit into *sensible* chunks.
A sensible chunk only does a single thing (e.g. "fix bug #666", or "proper indentation").
If you have fixed two bugs in a single file, it's probably good to make this *two separate* commits.
Even if each commit only changes a single line.
Otoh, a sensible chunk *can* (and often does) spread over multiple files.
E.g. if you have added a new feature by adding a new method to an object, this most often means that
you had to edit both the header and the implementation file for this object.
The changes to both files belong together and therefore should go into a single commit.

Avoid committing pd-patches and C++ code within the same
commit. Conflicts in C++-code can usually easily be resolved, whereas
conflicts in Pd-patches are usually impossible to resolve (but for the
most trivial cases).

Do *not* add binary data to the git repository (without a consensus on gem-dev first).
Not even temporarily!

git branching
-------------
Try to avoid forking from branches other than master.
Esp. avoid branches on top of branches.
Before committing a pull request, make sure that your branch applies clean to current master.



Programming Language
====================
Gem is (mainly) written in C++.

C-style vs C++-style
--------------------
while Pd is written in C, Gem is written in C++;
please try to use C++ idioms whenever possible.

use STL instead of inventing your own data containers!
esp. use "std::string" instead of "char*" whenever possible

the Gem code base is full of C-idioms and types; this is mainly because i
started as a C-programmer and only gradually learned using C++; don't repeat my
follies :-)

C++ standard
------------
Gem compiles on many platforms: the build machine that builds the W32-binaries
is an old XP-machine running "Microsoft VisualStudio 6", which was released
in 1998. Gem needs to be able to compile on this machine.
This means, that we cannot use any new language features introduced after (or
around) that date, including: C++98, C++03, C++11, C++??


private/protected/public
------------------------
ctor/dtor should be public
methods should be protected/public
members should be protected

private members should be hidden using a PIMPL idiom

initialization
--------------
initialize all member variables in the constructor(s).
use "member initialization lists" when possible.
e.g. use
> foo::foo(void) : m_x(0), m_y(0) {}
rather than
> foo::foo(void) { m_x=0; m_y=0; }


callbacks
---------
message callbacks from the RTE should be implemented using the CPPEXTERN_MSG*
macros defined in src/RTE/MessageCallbacks.h
this removes the need for static callbacks in the header-files

variable naming
---------------
member variables should be prefixed with "m_"
static variables should be prefixed with "s_"

import/export
-------------
all functions/classes that should be visible from outside must be exported using
the GEM_EXTERN macro.
all objectclasses are exported.
all utility classes are exported.



Dependencies
============
the dependencies of Gem should be kept at a minimum (ideally only openGL)
objectclasses that use special libraries should go into extra/
if you want to add functionality to Gem that is (or can be) implemented by a
number of different backends (libraries), this should be done via an abstract
interface and *plugins*, thus moving the binary dependency outside of Gem.


Code layout
===========

whitespace
----------
Please avoid *any* trailing whitespace.
Remove trailing whitespaces before committing.
`git` has a *pre-commit* hook example, that checks for trailing whitespace and
will warn you when you try committing such code.
you can enable it with something like:
$ cp .git/hooks/pre-commit.sample .git/hooks/pre-commit

Indentation
-----------
TODO






Filesystem layout
=================

directory structure
-------------------
src/Gem
	Gem core architecture classes
src/Utils
	Utilitiy code that can be re-used in several different contexts
src/RTE
	Pd-specific code (RTE=Real Time Environment)
	(in the far future i would like to have all Pd-specific code wrapped in
	here)
src/plugins
	plugin infrastructure and (pure virtual) baseclasses for the various
	plugins
src/Base
	Base classes for objectclasses
src/deprecated
	deprecated headers for backward compatibility

src/Controls/
	objectclasses: CONTROL
src/Manips/
	objectclasses: MANIPulatorS
src/Geos/
	objectclasses: GEometric ObjectS
src/Nongeos/
	objectclasses: positionable Objects that are not Geos
src/openGL/
	objectclasses: OPENGL wrapper objects
src/Particles/
	objectclasses: PARTICLE engine
src/Pixes/
	objectclasses: PIXEl proceSsing

src/Output/
	objectclasses: window handling

plugins/*/
	plugin implementations for various backends

extra/*/
	additional objectclasses

directories containing objectclasses, should not hold auxiliary files!
these should go into src/Utils/ (if they are of general interest) or the code
should be embedded into the objectclass code.
a noteable exception is the extra/*/ folder


file structure
--------------
C++ files are suffixed ".cpp".
they are accompanied by a header file ".h" containing the public interface.
there is a file for each objectclass named like the objectclass. e.g.
> src/Manips/ortho.cpp
contains the code for the [ortho] objectclass.
