#use "configure" to generate a Makefile out of this

TARGET = @target@
CXXLINK = @CXX@ $(CXXFLAGS) -o $@
LDFLAGS = @LDFLAGS@ 
LDADD = @arch_ld_flags@
LIBS = @LIBS@
INCLUDES = @INCLUDES@

PDLIBDIR = @prefix@@PDBASE@
DOCBASE = @DOCBASE@

TARG_DIR = ../Manips  ../Particles ../Base ../MarkEx ../Pixes ../Controls ../Nongeos  ../Geos ../openGL

OBJECTS = ../Manips/*.o \
         ../Particles/*.o \
         ../Base/*.o \
         ../MarkEx/*.o \
         ../Pixes/*.o \
         ../Controls/*.o \
         ../Nongeos/*.o \
         ../Geos/*.o \
	 ../openGL/*.o \


all: subdirs Gem.$(TARGET)

cleangem:
	@rm -f Gem.$(TARGET)

Gem.$(TARGET): cleangem $(Gem_pd_DEPENDENCIES)
	$(CXXLINK) $(LDFLAGS) $(OBJECTS) $(LDADD) $(LIBS)
	strip --strip-unneeded Gem.$(TARGET)
	cp Gem.$(TARGET) ../../

tmp: /tmp/Gem.$(TARGET)
	strip --strip-unneeded /tmp/Gem.$(TARGET)

/tmp/Gem.$(TARGET): subdirs
	$(CXXLINK) $(LDFLAGS) $(OBJECTS) $(LDADD) $(LIBS)

subdirs:
	for d in ${TARG_DIR}; do \
	    echo ""\
	    echo "----------$$d----------"; \
	    cd $$d && ${MAKE} -j4|| exit -1; \
	done


depend:
	@for d in ${TARG_DIR}; do \
	    echo "\n----------$$d----------"; \
	    cd $$d ; ${MAKE} depend; cd ../Gnu; \
	done


clean:
	@for d in ${TARG_DIR}; do \
	    echo "\n----------$$d----------"; \
	    cd $$d ; ${MAKE} clean;cd ../Gnu; \
	done
	-rm Gem.$(TARGET) *~

distclean: clean
	-rm ../../Gem.$(TARGET)
	@for d in ${TARG_DIR}; do \
	  echo "\n----------$$d----------"; \
	  cd $$d ; ${MAKE} distclean;cd ../Gnu; \
	done
	-rm config.cache config.log config.status Makefile
	./makeauxlibs clean
	cp Makefile.clean Makefile


install: installdocs
	install -m644 -D ../../Gem.$(TARGET) $(DESTDIR)/$(PDLIBDIR)/extra/Gem.$(TARGET)

installdocs:
	install -d $(DESTDIR)/$(PDLIBDIR)/doc/gem
	install -d $(DESTDIR)/$(PDLIBDIR)/doc/gem/examples
	for d in ../../examples/*.*; do \
	  dudu=$${d#../../examples/}; \
	  install -d $(DESTDIR)/$(PDLIBDIR)/doc/gem/examples/$$dudu; \
	  install -m644 $$d/*.* $(DESTDIR)/$(PDLIBDIR)/doc/gem/examples/$$dudu; \
	done

	install -d $(DESTDIR)/$(PDLIBDIR)/doc/gem/manual
	install -m644 ../../manual/*.* $(DESTDIR)/$(PDLIBDIR)/doc/gem/manual

	install -m644 ../../doc/*.* $(DESTDIR)/$(PDLIBDIR)/doc/gem/

	install -d $(DESTDIR)/$(PDLIBDIR)/@REFERENCEPATH@
	install -m644 ../../help/*.* $(DESTDIR)/$(PDLIBDIR)/@REFERENCEPATH@


